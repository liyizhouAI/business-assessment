<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AI一人公司·商业项目定位自查系统</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 375px;
            margin: 0 auto;
            background: #fff;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        .page {
            display: none;
            padding: 20px;
            min-height: 100vh;
            animation: slideIn 0.3s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }

        .progress-bar {
            height: 4px;
            background: #f0f0f0;
            border-radius: 2px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            background: #fff;
        }

        .score-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border: 2px solid #e9ecef;
            transition: border-color 0.3s ease;
        }

        .score-item:hover {
            border-color: #667eea;
        }

        .score-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
        }

        .score-desc {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .score-example {
            font-size: 12px;
            color: #888;
            line-height: 1.4;
            margin-bottom: 15px;
            font-style: italic;
        }

        .score-slider {
            width: 100%;
            margin: 10px 0;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .score-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .score-value {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-top: 10px;
        }

        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-top: 20px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            margin-right: 10px;
            width: calc(50% - 5px);
        }

        .btn-primary {
            width: calc(50% - 5px);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .score-summary {
            background: linear-gradient(135deg, #667eea20, #764ba220);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .total-score {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .score-rating {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .rating-excellent { color: #28a745; }
        .rating-good { color: #ffc107; }
        .rating-poor { color: #dc3545; }

        .dimension-scores {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .dimension-item {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .dimension-name {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .dimension-score {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .intro-content {
            line-height: 1.6;
            color: #555;
        }

        .intro-content h3 {
            color: #667eea;
            margin: 20px 0 10px 0;
        }

        .intro-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .intro-content li {
            margin-bottom: 8px;
        }

        .highlight-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .warning-text {
            color: #856404;
            font-weight: 500;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 10px 0;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .checkbox-item:hover {
            background-color: #f8f9fa;
        }

        .checkbox-item input[type="checkbox"] {
            display: none;
        }

        .checkbox-item .checkmark {
            width: 18px;
            height: 18px;
            border: 2px solid #ddd;
            border-radius: 4px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .checkbox-item input[type="checkbox"]:checked + .checkmark {
            background-color: #667eea;
            border-color: #667eea;
        }

        .checkbox-item input[type="checkbox"]:checked + .checkmark::after {
            content: "✓";
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .form-hint {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
            line-height: 1.4;
            font-style: italic;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        #char-count {
            font-weight: 600;
            color: #dc3545;
        }

        /* AI分析页面样式 */
        .analysis-container {
            text-align: center;
            padding: 50px 20px;
        }

        .breathing-circle {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 40px;
        }

        .circle-inner, .circle-middle, .circle-outer {
            position: absolute;
            border-radius: 50%;
            border: 2px solid #667eea;
        }

        .circle-inner {
            width: 40px;
            height: 40px;
            top: 40px;
            left: 40px;
            background: #667eea;
            animation: breathe-inner 3s ease-in-out infinite;
        }

        .circle-middle {
            width: 80px;
            height: 80px;
            top: 20px;
            left: 20px;
            animation: breathe-middle 3s ease-in-out infinite;
        }

        .circle-outer {
            width: 120px;
            height: 120px;
            top: 0;
            left: 0;
            animation: breathe-outer 3s ease-in-out infinite;
        }

        @keyframes breathe-inner {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        @keyframes breathe-middle {
            0%, 100% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.1); opacity: 0.3; }
        }

        @keyframes breathe-outer {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.05); opacity: 0.1; }
        }

        .analysis-status {
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-text {
            font-size: 16px;
            color: #667eea;
            font-weight: 500;
            opacity: 0;
            animation: fadeInOut 1s ease-in-out infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .status-completed {
            animation: none !important;
            opacity: 1 !important;
            color: #28a745 !important;
            font-weight: 600;
        }

        .breathing-completed .circle-inner,
        .breathing-completed .circle-middle,
        .breathing-completed .circle-outer {
            animation: none !important;
        }

        .breathing-completed .circle-inner {
            background: #28a745;
            border-color: #28a745;
        }

        .breathing-completed .circle-middle,
        .breathing-completed .circle-outer {
            border-color: #28a745;
            opacity: 0.3;
        }

        .progress-dots-completed .dot {
            animation: none !important;
            background: #28a745;
            opacity: 1;
        }

        .analysis-progress {
            margin-top: 30px;
        }

        .progress-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: dotPulse 1.5s ease-in-out infinite;
        }

        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes dotPulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* 报告页面样式 */
        .report-content {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            line-height: 1.5;
            color: #333;
        }

        .report-content h1 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .report-content h2 {
            color: #2c3e50;
            font-size: 20px;
            margin: 25px 0 15px 0;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .report-content h3 {
            color: #667eea;
            font-size: 16px;
            margin: 20px 0 10px 0;
            font-weight: 600;
        }

        .report-content p {
            line-height: 1.6;
            margin-bottom: 12px;
            color: #2c3e50;
        }

        .report-content hr {
            border: none;
            height: 1px;
            background: linear-gradient(90deg, transparent, #e9ecef, transparent);
            margin: 20px 0;
        }

        .report-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 30px;
            align-items: center;
        }

        .report-actions-row {
            display: flex;
            gap: 8px;
            width: 100%;
            justify-content: center;
        }

        .report-actions .btn-small {
            flex: 1;
            max-width: 100px;
            padding: 12px 8px;
            font-size: 14px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .report-actions .btn-small:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .report-actions .btn-reset {
            width: 100%;
            max-width: 300px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .report-content .report-footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
            text-align: center;
            color: #666;
            font-size: 13px;
            line-height: 1.6;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 首页介绍 -->
        <div class="page active" id="page-intro">
            <div class="header">
                <div class="logo">AI一人公司</div>
                <div class="subtitle">商业项目定位自查系统</div>
            </div>

            <div class="intro-content">
                <h3>🎯 工具价值</h3>
                <p>本系统由一舟老师基于多年商业实践和近百万学员教学案例精心打造，是一个严格而通用的商业项目定位自查解决方案。此前主要用于商学院和重大咨询客户的项目诊断，现首次开放给更多学员。</p>

                <h3>📊 评估标准</h3>
                <p>系统采用严格的100分制评估体系：</p>
                <ul>
                    <li><strong>85分及以上</strong>：优质项目</li>
                    <li><strong>70-85分</strong>：优良项目</li>
                    <li><strong>70分以下</strong>：不建议投入</li>
                </ul>

                <div class="highlight-box">
                    <p class="warning-text">⚠️ 现实检验：在大量商业实践中发现，平均每100个商业项目中，只有1个能真正成功盈利。99%的项目难以通过严格的定位自查。</p>
                </div>

                <h3>🔒 隐私承诺</h3>
                <p>您填写的所有信息仅由一舟老师和您本人知晓，不会用于任何第三方商业用途，不会用于AI训练，不做数据存储，更不会泄露隐私。</p>

                <h3>✍️ 填写建议</h3>
                <p>请认真对待每一个选项，信息越完整，系统诊断效果越好。不方便透露的部分可选择不填，但请为自己的项目负责。</p>
            </div>

            <button class="btn" onclick="nextPage()">开始评估</button>
        </div>

        <!-- 基本信息页 -->
        <div class="page" id="page-basic">
            <div class="header">
                <div class="logo">基本信息</div>
                <div class="subtitle">请完善您的项目基础信息</div>
            </div>

            <div class="progress-bar">
                <div class="progress" style="width: 16.6%"></div>
            </div>

            <form id="basic-form">
                <div class="form-group">
                    <label class="form-label">姓名或昵称</label>
                    <input type="text" class="form-input" name="name">
                </div>

                <div class="form-group">
                    <label class="form-label">手机号或微信号</label>
                    <input type="text" class="form-input" name="contact">
                </div>

                <div class="form-group">
                    <label class="form-label">邮箱</label>
                    <input type="email" class="form-input" name="email">
                </div>

                <div class="form-group">
                    <label class="form-label">所属行业</label>
                    <select class="form-select" name="industry" onchange="toggleOtherIndustry(this.value)">
                        <option value="">请选择行业</option>
                        <option value="电商零售">电商零售</option>
                        <option value="餐饮服务">餐饮服务</option>
                        <option value="教育培训">教育培训</option>
                        <option value="内容创作">内容创作</option>
                        <option value="咨询服务">咨询服务</option>
                        <option value="技术开发">技术开发</option>
                        <option value="美容健康">美容健康</option>
                        <option value="金融保险">金融保险</option>
                        <option value="房地产">房地产</option>
                        <option value="制造业">制造业</option>
                        <option value="物流运输">物流运输</option>
                        <option value="医疗健康">医疗健康</option>
                        <option value="文化娱乐">文化娱乐</option>
                        <option value="旅游住宿">旅游住宿</option>
                        <option value="农业农产品">农业农产品</option>
                        <option value="汽车服务">汽车服务</option>
                        <option value="家政服务">家政服务</option>
                        <option value="建筑装修">建筑装修</option>
                        <option value="法律服务">法律服务</option>
                        <option value="AI从业者">AI从业者</option>
                        <option value="一人公司">一人公司</option>
                        <option value="其他">其他</option>
                    </select>
                </div>

                <div class="form-group" id="other-industry-group" style="display: none;">
                    <label class="form-label">请填写具体行业</label>
                    <input type="text" class="form-input" name="other_industry" placeholder="请输入您的具体行业">
                </div>

                <div class="form-group">
                    <label class="form-label">项目阶段</label>
                    <select class="form-select" name="stage">
                        <option value="">请选择阶段</option>
                        <option value="想法构思阶段">想法构思阶段</option>
                        <option value="市场调研阶段">市场调研阶段</option>
                        <option value="产品开发阶段">产品开发阶段</option>
                        <option value="试运营阶段">试运营阶段</option>
                        <option value="正式运营阶段">正式运营阶段</option>
                        <option value="成熟发展期">成熟发展期</option>
                        <option value="行业下行期">行业下行期</option>
                        <option value="个人迷茫期">个人迷茫期</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">预期投入时间</label>
                    <select class="form-select" name="time_investment">
                        <option value="">请选择</option>
                        <option value="兼职">兼职（每周10小时以内）</option>
                        <option value="半职">半职（每周20-30小时）</option>
                        <option value="全职">全职（每周40小时以上）</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">启动资金范围</label>
                    <select class="form-select" name="budget">
                        <option value="">请选择</option>
                        <option value="1万以下">1万以下</option>
                        <option value="1-5万">1-5万</option>
                        <option value="5-10万">5-10万</option>
                        <option value="10-50万">10-50万</option>
                        <option value="50万以上">50万以上</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">目标用户群体 *</label>
                    <div class="checkbox-group" id="target-audience-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="target_audience" value="都市白领">
                            <span class="checkmark"></span>
                            都市白领
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="target_audience" value="学生群体">
                            <span class="checkmark"></span>
                            学生群体
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="target_audience" value="宝妈群体">
                            <span class="checkmark"></span>
                            宝妈群体
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="target_audience" value="中老年群体">
                            <span class="checkmark"></span>
                            中老年群体
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="target_audience" value="小镇青年">
                            <span class="checkmark"></span>
                            小镇青年
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="target_audience" value="创业者">
                            <span class="checkmark"></span>
                            创业者
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="target_audience" value="艺术文化爱好者">
                            <span class="checkmark"></span>
                            艺术文化爱好者
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="target_audience" value="时尚潮流群体">
                            <span class="checkmark"></span>
                            时尚潮流群体
                        </label>
                    </div>
                    <div class="form-hint">请选择1-3个目标用户群体</div>
                </div>

                <div class="form-group">
                    <label class="form-label">项目简述（至少100字）*</label>
                    <textarea class="form-input form-textarea" name="description" id="project-description" maxlength="500" placeholder="详细描述您的项目内容、目标用户、商业模式和目前遇到的核心问题" oninput="updateCharCount(this)"></textarea>
                    <div class="form-hint">
                        <span id="char-count">0/100 字</span> - 深度思考后认真填写，好项目通常能用一句逻辑自洽，轻松写意的话精准描述，如果你还做不到，就多写一些，晚一些让AI替你润色思考。
                    </div>
                </div>
            </form>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevPage()">返回</button>
                <button class="btn btn-primary" onclick="nextPage()">下一步</button>
            </div>
        </div>

        <!-- 流量评估页 -->
        <div class="page" id="page-traffic">
            <div class="header">
                <div class="logo">流量评估</div>
                <div class="subtitle">评估您的客户来源能力</div>
            </div>

            <div class="progress-bar">
                <div class="progress" style="width: 33.3%"></div>
            </div>

            <div class="score-summary">
                <div class="score-rating">流量维度得分</div>
                <div class="total-score" id="traffic-total">6</div>
                <div class="subtitle">满分30分</div>
            </div>

            <div id="traffic-scores">
                <div class="score-item">
                    <div class="score-title">核心流量优势（5分）</div>
                    <div class="score-desc">独特的获客渠道或资源优势</div>
                    <div class="score-example">如黄金地段实体店、垄断性资源、独家合作关系、特殊身份背景、稀缺技能认证等，这些是竞争对手难以复制的天然流量优势</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="traffic-1" oninput="updateScore('traffic', 1, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="traffic-1-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">自有流量渠道（5分）</div>
                    <div class="score-desc">微信群、公众号、私域等</div>
                    <div class="score-example">已建立的粉丝群体、邮件列表、会员体系等，可直接触达的用户池，发布内容或新品时无需付费推广</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="traffic-2" oninput="updateScore('traffic', 2, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="traffic-2-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">线上引流能力（5分）</div>
                    <div class="score-desc">短视频、直播、内容营销等个人IP能力</div>
                    <div class="score-example">在抖音、小红书、B站等平台的内容创作和涨粉能力，通过优质内容吸引精准用户关注并转化</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="traffic-3" oninput="updateScore('traffic', 3, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="traffic-3-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">老客户基础（5分）</div>
                    <div class="score-desc">现有客户数量及忠诚度</div>
                    <div class="score-example">老客户的复购和口碑传播是没有新增流量成本的，且常年消费对于价格变化不敏感，也更愿意尝试新品，接受偶然的口味和服务不佳，不影响其继续消费</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="traffic-4" oninput="updateScore('traffic', 4, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="traffic-4-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">平台获客能力（5分）</div>
                    <div class="score-desc">淘宝、美团、抖音等平台运营能力</div>
                    <div class="score-example">在第三方平台的店铺运营、广告投放、搜索排名优化等技能，能有效利用平台流量进行获客转化</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="traffic-5" oninput="updateScore('traffic', 5, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="traffic-5-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">合作渠道资源（5分）</div>
                    <div class="score-desc">渠道商、代理商、异业合作等</div>
                    <div class="score-example">已建立的分销网络、代理体系，或与其他商家的互推合作，通过合作伙伴扩大客户覆盖面</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="traffic-6" oninput="updateScore('traffic', 6, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="traffic-6-value">1分</div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevPage()">返回</button>
                <button class="btn btn-primary" onclick="nextPage()">下一步</button>
            </div>
        </div>

        <!-- 运营评估页 -->
        <div class="page" id="page-operation">
            <div class="header">
                <div class="logo">运营评估</div>
                <div class="subtitle">评估您的管理和执行能力</div>
            </div>

            <div class="progress-bar">
                <div class="progress" style="width: 50%"></div>
            </div>

            <div class="score-summary">
                <div class="score-rating">运营维度得分</div>
                <div class="total-score" id="operation-total">6</div>
                <div class="subtitle">满分30分</div>
            </div>

            <div id="operation-scores">
                <div class="score-item">
                    <div class="score-title">个人执行效率（5分）</div>
                    <div class="score-desc">时间管理、工作效率</div>
                    <div class="score-example">能够高效安排工作时间，快速决策执行，单人产出效率高，不拖延不纠结，具备强执行力</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="operation-1" oninput="updateScore('operation', 1, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="operation-1-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">团队协作基础（5分）</div>
                    <div class="score-desc">现有团队规模及配合度</div>
                    <div class="score-example">有稳定的合作伙伴或小团队，分工明确，沟通顺畅，能够有效协作完成复杂任务，降低管理成本</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="operation-2" oninput="updateScore('operation', 2, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="operation-2-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">业务标准化程度（5分）</div>
                    <div class="score-desc">流程、制度、SOP完善度</div>
                    <div class="score-example">业务流程清晰可复制，有标准作业程序，新人可快速上手，减少对个人经验依赖，便于规模化扩张</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="operation-3" oninput="updateScore('operation', 3, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="operation-3-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">产品/内容输出能力（5分）</div>
                    <div class="score-desc">持续生产优质内容/产品的能力</div>
                    <div class="score-example">能稳定输出高质量产品或内容，有创新能力和持续改进机制，保持用户粘性和市场竞争力</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="operation-4" oninput="updateScore('operation', 4, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="operation-4-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">供应链控制力（5分）</div>
                    <div class="score-desc">上游供应商关系及成本控制</div>
                    <div class="score-example">与供应商关系稳定，有议价能力，能控制采购成本和交期，降低断货风险，提高毛利率</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="operation-5" oninput="updateScore('operation', 5, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="operation-5-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">数据运营能力（5分）</div>
                    <div class="score-desc">用户行为分析、转化率优化等</div>
                    <div class="score-example">能通过数据分析用户行为，优化转化流程，提升运营效率，用数据驱动业务决策而非凭感觉</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="operation-6" oninput="updateScore('operation', 6, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="operation-6-value">1分</div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevPage()">返回</button>
                <button class="btn btn-primary" onclick="nextPage()">下一步</button>
            </div>
        </div>

        <!-- 服务评估页 -->
        <div class="page" id="page-service">
            <div class="header">
                <div class="logo">服务评估</div>
                <div class="subtitle">评估您的产品服务能力</div>
            </div>

            <div class="progress-bar">
                <div class="progress" style="width: 66.6%"></div>
            </div>

            <div class="score-summary">
                <div class="score-rating">服务维度得分</div>
                <div class="total-score" id="service-total">6</div>
                <div class="subtitle">满分30分</div>
            </div>

            <div id="service-scores">
                <div class="score-item">
                    <div class="score-title">产品属性优势（5分）</div>
                    <div class="score-desc">实体vs虚拟、标准vs非标</div>
                    <div class="score-example">虚拟产品无库存压力，非标产品有差异化优势，产品形态决定了交付成本和扩张难度</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="service-1" oninput="updateScore('service', 1, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="service-1-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">毛利率水平（5分）</div>
                    <div class="score-desc">单品利润空间</div>
                    <div class="score-example">高毛利意味着更强的抗风险能力和市场投入空间，如咨询课程毛利80%+，而餐饮零售通常20-30%</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="service-2" oninput="updateScore('service', 2, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="service-2-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">服务标准化（5分）</div>
                    <div class="score-desc">可复制性、培训难度</div>
                    <div class="score-example">标准化程度高的服务易于培训和复制，能快速扩张，降低对核心人员依赖，提高运营稳定性</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="service-3" oninput="updateScore('service', 3, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="service-3-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">复购率潜力（5分）</div>
                    <div class="score-desc">用户重复购买可能性</div>
                    <div class="score-example">高复购意味着客户生命周期价值高，获客成本可分摊，如美容美发、教育培训等天然高复购行业</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="service-4" oninput="updateScore('service', 4, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="service-4-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">交付成本（5分）</div>
                    <div class="score-desc">履约成本、售后服务成本</div>
                    <div class="score-example">交付成本低的业务扩张容易，如数字产品一次开发无限复制，而定制服务每单都需重新投入人力</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="service-5" oninput="updateScore('service', 5, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="service-5-value">1分</div>
                </div>

                <div class="score-item">
                    <div class="score-title">市场竞争壁垒（5分）</div>
                    <div class="score-desc">技术门槛、资源门槛等</div>
                    <div class="score-example">有技术专利、独特资源、行业经验等壁垒的业务，竞争对手难以快速模仿，能维持长期竞争优势</div>
                    <input type="range" class="slider" min="1" max="5" value="1" id="service-6" oninput="updateScore('service', 6, this.value)">
                    <div class="score-labels">
                        <span>1分</span>
                        <span>5分</span>
                    </div>
                    <div class="score-value" id="service-6-value">1分</div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevPage()">返回</button>
                <button class="btn btn-primary" onclick="nextPage()">下一步</button>
            </div>
        </div>

        <!-- 个人喜好页 -->
        <div class="page" id="page-preference">
            <div class="header">
                <div class="logo">个人喜好</div>
                <div class="subtitle">评估您对项目的热情度</div>
            </div>

            <div class="progress-bar">
                <div class="progress" style="width: 83.3%"></div>
            </div>

            <div class="score-summary">
                <div class="score-rating">个人喜好得分</div>
                <div class="total-score" id="preference-total">1</div>
                <div class="subtitle">满分10分</div>
            </div>

            <div class="score-item">
                <div class="score-title">项目热情度（10分）</div>
                <div class="score-desc">您对此项目的长期投入意愿</div>
                <div class="score-example">若准备将此项目作为终身事业，可打8-10分；若仅是尝试、从未做过或勉强为之，建议打1-3分</div>
                <input type="range" class="slider" min="1" max="10" value="1" id="preference-1" oninput="updateScore('preference', 1, this.value)">
                <div class="score-labels">
                    <span>1分</span>
                    <span>10分</span>
                </div>
                <div class="score-value" id="preference-1-value">1分</div>
            </div>

            <div class="form-group" id="passion-reason" style="display: none;">
                <label class="form-label">请简述您对此项目如此热情的理由 *</label>
                <textarea class="form-input form-textarea" id="passion-text" placeholder="请用一句话说明您选择高分的原因" maxlength="100"></textarea>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevPage()">返回</button>
                <button class="btn btn-primary" onclick="nextPage()">查看结果</button>
            </div>
        </div>

        <!-- 结果展示页 -->
        <div class="page" id="page-result">
            <div class="header">
                <div class="logo">评估结果</div>
                <div class="subtitle">您的项目综合评分</div>
            </div>

            <div class="progress-bar">
                <div class="progress" style="width: 100%"></div>
            </div>

            <div class="score-summary">
                <div class="total-score" id="final-score">19</div>
                <div class="score-rating" id="final-rating">不建议投入</div>
                <div class="subtitle">满分100分</div>
            </div>

            <div class="dimension-scores">
                <div class="dimension-item">
                    <div class="dimension-name">流量维度</div>
                    <div class="dimension-score" id="result-traffic">6</div>
                </div>
                <div class="dimension-item">
                    <div class="dimension-name">运营维度</div>
                    <div class="dimension-score" id="result-operation">6</div>
                </div>
                <div class="dimension-item">
                    <div class="dimension-name">服务维度</div>
                    <div class="dimension-score" id="result-service">6</div>
                </div>
                <div class="dimension-item">
                    <div class="dimension-name">个人喜好</div>
                    <div class="dimension-score" id="result-preference">1</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">接收详细分析报告的邮箱</label>
                <input type="email" class="form-input" id="report-email" placeholder="请输入您的邮箱地址">
            </div>

            <button class="btn" onclick="generateReport()">生成详细分析报告</button>
            <button class="btn btn-secondary" onclick="resetAssessment()" style="width: 100%; margin-top: 10px;">重新评估</button>
        </div>

        <!-- AI分析页面 -->
        <div class="page" id="page-analysis">
            <div class="header">
                <div class="logo">AI深度分析中</div>
                <div class="subtitle">正在为您生成专业的商业定位报告</div>
            </div>

            <div class="analysis-container">
                <div class="breathing-circle">
                    <div class="circle-inner"></div>
                    <div class="circle-middle"></div>
                    <div class="circle-outer"></div>
                </div>

                <div class="analysis-status" id="analysis-status">
                    <div class="status-text">初始化分析引擎...</div>
                </div>

                <div class="analysis-progress">
                    <div class="progress-dots">
                        <span class="dot"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </div>
                </div>
            </div>

            <button class="btn" id="view-report-btn" style="display: none;" onclick="showReport()">查看报告</button>
        </div>

        <!-- 报告展示页面 -->
        <div class="page" id="page-report">
            <div class="header">
                <div class="logo">商业定位分析报告</div>
                <div class="subtitle">基于AI深度分析的专业评估</div>
            </div>

            <div class="report-content" id="report-content">
                <!-- 报告内容将在这里动态生成 -->
            </div>

            <div class="report-actions">
                <div class="report-actions-row">
                    <button class="btn-small" onclick="saveAsImage()">保存图片</button>
                    <button class="btn-small" onclick="copyText()">复制文字</button>
                    <button class="btn-small" onclick="downloadMD()">下载MD</button>
                </div>
                <button class="btn btn-reset" onclick="resetAssessment()">重新评估</button>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let currentPage = 0;
        let scores = {
            traffic: [1, 1, 1, 1, 1, 1],
            operation: [1, 1, 1, 1, 1, 1],
            service: [1, 1, 1, 1, 1, 1],
            preference: [1]
        };

        const pages = ['page-intro', 'page-basic', 'page-traffic', 'page-operation', 'page-service', 'page-preference', 'page-result', 'page-analysis', 'page-report'];

        // 处理行业选择的其他选项
        function toggleOtherIndustry(value) {
            const otherGroup = document.getElementById('other-industry-group');
            if (value === '其他') {
                otherGroup.style.display = 'block';
            } else {
                otherGroup.style.display = 'none';
                document.querySelector('input[name="other_industry"]').value = '';
            }
        }

        // 页面导航函数
        function showPage(index) {
            pages.forEach((pageId, i) => {
                const page = document.getElementById(pageId);
                if (i === index) {
                    page.classList.add('active');
                } else {
                    page.classList.remove('active');
                }
            });
            
            // 如果进入结果页面，确保总分正确显示
            if (index === 6) { // page-result
                setTimeout(() => {
                    updateFinalResult();
                }, 100);
            }
        }

        function nextPage() {
            if (currentPage < pages.length - 1) {
                // 验证当前页面
                if (currentPage === 1) { // 基本信息页
                    if (!validateBasicInfo()) return;
                } else if (currentPage === 2) { // 流量评估页
                    if (!validateScorePage('traffic')) return;
                } else if (currentPage === 3) { // 运营评估页
                    if (!validateScorePage('operation')) return;
                } else if (currentPage === 4) { // 服务评估页
                    if (!validateScorePage('service')) return;
                } else if (currentPage === 5) { // 个人喜好页
                    if (!validatePreferencePage()) return;
                }
                
                currentPage++;
                showPage(currentPage);
                
                if (currentPage === pages.length - 1) {
                    updateFinalResult();
                }
            }
        }

        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                showPage(currentPage);
            }
        }

        // 更新字数统计
        function updateCharCount(textarea) {
            const charCount = textarea.value.length;
            const countElement = document.getElementById('char-count');
            countElement.textContent = `${charCount}/100 字`;
            
            if (charCount >= 100) {
                countElement.style.color = '#28a745';
                textarea.style.borderColor = '#28a745';
            } else {
                countElement.style.color = '#dc3545';
                textarea.style.borderColor = '#dc3545';
            }
        }

        // 验证基本信息页面
        function validateBasicInfo() {
            // 验证目标用户群体选择
            const checkedBoxes = document.querySelectorAll('input[name="target_audience"]:checked');
            
            if (checkedBoxes.length === 0) {
                alert('请至少选择1个目标用户群体');
                return false;
            }
            
            if (checkedBoxes.length > 3) {
                alert('最多只能选择3个目标用户群体');
                return false;
            }
            
            // 验证项目描述字数
            const description = document.getElementById('project-description').value.trim();
            if (description.length < 100) {
                alert('项目简述至少需要100字，请详细描述您的项目内容、目标用户、商业模式和目前遇到的核心问题');
                document.getElementById('project-description').focus();
                return false;
            }
            
            return true;
        }

        // 验证打分页面
        function validateScorePage(dimension) {
            // 由于现在最低分是1分，所有项目都已经有分数，无需验证
            return true;
        }

        // 验证个人喜好页面
        function validatePreferencePage() {
            const score = scores.preference[0];
            
            if (score >= 8) {
                const reasonText = document.getElementById('passion-text').value.trim();
                if (!reasonText) {
                    document.getElementById('passion-text').style.borderColor = '#dc3545';
                    alert('请填写您对此项目如此热情的理由');
                    return false;
                } else {
                    document.getElementById('passion-text').style.borderColor = '#e0e0e0';
                }
            }
            
            return true;
        }

        // 分数更新函数
        function updateScore(dimension, index, value) {
            scores[dimension][index - 1] = parseInt(value);
            document.getElementById(`${dimension}-${index}-value`).textContent = `${value}分`;
            
            // 特殊处理个人喜好页面
            if (dimension === 'preference' && index === 1) {
                const reasonDiv = document.getElementById('passion-reason');
                if (parseInt(value) >= 8) {
                    reasonDiv.style.display = 'block';
                } else {
                    reasonDiv.style.display = 'none';
                    document.getElementById('passion-text').value = '';
                }
            }
            
            // 更新维度总分
            const total = scores[dimension].reduce((sum, score) => sum + score, 0);
            document.getElementById(`${dimension}-total`).textContent = total;
            
            // 更新进度（如果在结果页）
            if (currentPage === pages.length - 1) {
                updateFinalResult();
            }
        }

        // 更新最终结果
        function updateFinalResult() {
            const trafficTotal = scores.traffic.reduce((sum, score) => sum + score, 0);
            const operationTotal = scores.operation.reduce((sum, score) => sum + score, 0);
            const serviceTotal = scores.service.reduce((sum, score) => sum + score, 0);
            const preferenceTotal = scores.preference.reduce((sum, score) => sum + score, 0);
            
            const finalScore = trafficTotal + operationTotal + serviceTotal + preferenceTotal;
            
            document.getElementById('final-score').textContent = finalScore;
            document.getElementById('result-traffic').textContent = trafficTotal;
            document.getElementById('result-operation').textContent = operationTotal;
            document.getElementById('result-service').textContent = serviceTotal;
            document.getElementById('result-preference').textContent = preferenceTotal;
            
            // 更新评级
            const ratingElement = document.getElementById('final-rating');
            if (finalScore >= 85) {
                ratingElement.textContent = '优质项目';
                ratingElement.className = 'score-rating rating-excellent';
            } else if (finalScore >= 70) {
                ratingElement.textContent = '优良项目';
                ratingElement.className = 'score-rating rating-good';
            } else {
                ratingElement.textContent = '不建议投入';
                ratingElement.className = 'score-rating rating-poor';
            }
        }

        // 生成报告
        function generateReport() {
            const email = document.getElementById('report-email').value;
            if (!email) {
                alert('请填写邮箱地址');
                return;
            }
            
            // 收集所有数据
            const userData = collectUserData();
            
            // 跳转到分析页面
            currentPage = 7; // page-analysis
            showPage(currentPage);
            
            // 开始分析动画
            startAnalysis(userData);
        }

        // 收集用户数据
        function collectUserData() {
            const formData = new FormData(document.getElementById('basic-form'));
            const basicInfo = Object.fromEntries(formData);
            
            // 处理行业选择（如果选择其他，则使用自定义输入）
            if (basicInfo.industry === '其他' && basicInfo.other_industry) {
                basicInfo.industry = basicInfo.other_industry;
            }
            
            // 处理多选的目标用户群体
            const checkedBoxes = document.querySelectorAll('input[name="target_audience"]:checked');
            const targetAudiences = Array.from(checkedBoxes).map(box => box.value);
            basicInfo.target_audience = targetAudiences.join(', ');
            
            // 收集个人喜好理由
            const passionReason = scores.preference[0] >= 8 ? document.getElementById('passion-text').value : '';
            
            // 计算总分
            const trafficTotal = scores.traffic.reduce((sum, score) => sum + score, 0);
            const operationTotal = scores.operation.reduce((sum, score) => sum + score, 0);
            const serviceTotal = scores.service.reduce((sum, score) => sum + score, 0);
            const preferenceTotal = scores.preference.reduce((sum, score) => sum + score, 0);
            const finalScore = trafficTotal + operationTotal + serviceTotal + preferenceTotal;
            
            return {
                basicInfo: basicInfo,
                scores: {
                    traffic: {
                        total: trafficTotal,
                        details: scores.traffic
                    },
                    operation: {
                        total: operationTotal,
                        details: scores.operation
                    },
                    service: {
                        total: serviceTotal,
                        details: scores.service
                    },
                    preference: {
                        total: preferenceTotal,
                        reason: passionReason
                    }
                },
                finalScore: finalScore,
                rating: finalScore >= 85 ? '优质项目' : finalScore >= 70 ? '优良项目' : '不建议投入',
                reportEmail: document.getElementById('report-email').value
            };
        }

        // 开始分析动画
        function startAnalysis(userData) {
            const statusTexts = [
                "分析用户所在行业竞品、大盘数据、行业发展趋势...",
                "在小型印钞机项目数据库中寻找相似度权重大于0.7的项目源...",
                "数据和项目信息匹配中...",
                "深度思考中...",
                "报告正在生成，请耐心等待..."
            ];
            
            const statusElement = document.querySelector('.status-text');
            let currentIndex = 0;
            
            function showNextStatus() {
                if (currentIndex < statusTexts.length) {
                    statusElement.textContent = statusTexts[currentIndex];
                    currentIndex++;
                    
                    // 随机间隔1-3秒
                    const delay = Math.random() * 2000 + 1000;
                    setTimeout(showNextStatus, delay);
                } else {
                    // 开始调用API生成报告
                    generateAIReport(userData);
                }
            }
            
            // 开始显示状态
            setTimeout(showNextStatus, 2000);
        }

        // 调用AI API生成报告
        async function generateAIReport(userData) {
            const statusElement = document.querySelector('.status-text');
            
            try {
                statusElement.textContent = "正在调用AI大模型分析...";
                
                // 首先尝试调用部署的API
                let response;
                try {
                    // 使用相对路径，自动匹配当前域名
                    response = await fetch('/api/generate-report', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            userData: userData
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API调用失败: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    // 分析完成，停止所有动画
                    statusElement.textContent = "AI分析完成！";
                    statusElement.classList.add('status-completed');
                    document.querySelector('.breathing-circle').classList.add('breathing-completed');
                    document.querySelector('.progress-dots').classList.add('progress-dots-completed');
                    
                    // 显示AI生成的报告
                    document.getElementById('report-content').innerHTML = convertMDToHTML(result.report);
                    
                    // 保存数据供后续使用
                    window.currentReportData = {
                        markdown: result.report,
                        html: convertMDToHTML(result.report),
                        userData: userData,
                        apiGenerated: true,
                        promptVersion: result.promptVersion
                    };
                    
                    // 显示查看报告按钮
                    document.getElementById('view-report-btn').style.display = 'block';
                    
                } catch (apiError) {
                    console.log('API调用失败，使用本地生成器:', apiError);
                    // 降级到本地生成器
                    statusElement.textContent = "使用本地分析引擎...";
                    setTimeout(() => {
                        generateLocalReport(userData);
                    }, 1000);
                }
                
            } catch (error) {
                console.error('报告生成失败:', error);
                statusElement.textContent = "生成遇到问题，使用备用方案...";
                
                // 最后的备用方案
                setTimeout(() => {
                    generateLocalReport(userData);
                }, 2000);
            }
        }

        // 本地报告生成
        function generateLocalReport(userData) {
            const reportMD = generateMarkdownReport(userData);
            const reportHTML = convertMDToHTML(reportMD);
            
            document.getElementById('report-content').innerHTML = reportHTML;
            
            // 分析完成，停止所有动画
            const statusElement = document.querySelector('.status-text');
            statusElement.textContent = "分析完成！";
            statusElement.classList.add('status-completed');
            document.querySelector('.breathing-circle').classList.add('breathing-completed');
            document.querySelector('.progress-dots').classList.add('progress-dots-completed');
            
            // 显示查看报告按钮
            document.getElementById('view-report-btn').style.display = 'block';
            
            // 保存数据供后续使用
            window.currentReportData = {
                markdown: reportMD,
                html: reportHTML,
                userData: userData,
                apiGenerated: false
            };
        }

        // 生成Markdown报告
        function generateMarkdownReport(userData) {
            const { basicInfo, scores, finalScore, rating } = userData;
            
            return `# 【李一舟3.0】商业项目定位分析报告

## 🎯 核心判断

**底层逻辑是**，你的项目定位精准度只有 **${Math.round(finalScore * 0.6)}%**，核心问题在商业闭环设计。

**讲白了就是**，${finalScore >= 70 ? '有一定基础，但流量获取和转化效率需要大幅提升' : '商业模式存在根本性问题，需要重新思考定位'}。

## 📊 深度解析

**项目定位分析**  
你的"${basicInfo.description ? basicInfo.description.substring(0, 50) + '...' : '项目描述'}"在${basicInfo.industry || '未知'}领域，当前处于${basicInfo.stage || '未明确'}阶段。从评分看，最大短板是${getWeakestDimension(scores)}。

**商业模式问题**  
目标用户${basicInfo.target_audience || '待明确'}，但价值主张不够清晰。${getIndustryAnalysis(basicInfo.industry)}

**运营效率瓶颈**  
标准化程度不足，个人执行效率有待提高。这直接影响了规模化的可能性。

**服务体验优化**  
用户体验设计和复购机制需要重新规划，单次交易思维是致命伤。

## ⚡ 行动清单

### 🔥 30天冲刺（流量突破）

**聚焦** 单一用户标签，重写价值主张  
*→ 7天内完成A/B测试，目标转化率提升50%*

**设计** 3个流量获客渠道，优先内容营销+私域运营  
*→ 30天内验证单客成本<200元*

### 📈 60天优化（运营升级）

**搭建** 标准化服务流程，提升复购率至40%  
*→ 60天内完成SOP制定*

**建立** 数据监控体系，追踪关键指标  
*→ 每周复盘流量-转化-留存数据*

### 🚀 90天验证（商业闭环）

**测试** 最小可行产品，验证核心假设  
*→ 90天内达成${finalScore < 50 ? '盈亏平衡' : finalScore < 70 ? '月收入1万+' : '规模化复制'}*

## 💡 心法提醒

核心在于先做对再做大。${finalScore < 50 ? '你现在需要的是产品市场匹配度，不是增长黑客' : '商业闭环已具雏形，重点是效率优化和规模复制'}。

选择大于努力，长期主义胜过投机取巧。

---
*本报告由"一舟一课 3.0知识库"结合优质大模型综合生成，内容和观点仅供参考，请您酌情采信。*`;
        }

        // 获取最弱维度
        function getWeakestDimension(scores) {
            const dimensions = [
                { name: '流量获取能力', score: scores.traffic.total },
                { name: '运营管理能力', score: scores.operation.total },
                { name: '服务交付能力', score: scores.service.total }
            ];
            
            dimensions.sort((a, b) => a.score - b.score);
            return dimensions[0].name;
        }

        // 获取行业分析
        function getIndustryAnalysis(industry) {
            const analyses = {
                'AI从业者': '技术背景深厚，但商业化能力待提升',
                '一人公司': '资源有限，需要追求效率最大化',
                '教育培训': '内容质量是核心，复购是关键',
                '电商零售': '供应链和流量是双重挑战',
                '咨询服务': '个人品牌和专业度决定天花板'
            };
            
            return analyses[industry] || '传统行业转型，需要数字化思维';
        }

        // 转换MD为HTML
        function convertMDToHTML(markdown) {
            let html = markdown
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/---/g, '<hr>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');
            
            // 包装在段落标签中
            html = '<p>' + html + '</p>';
            
            // 清理多余的段落标签
            html = html.replace(/<p><h/g, '<h').replace(/<\/h([1-6])><\/p>/g, '</h$1>');
            html = html.replace(/<p><hr><\/p>/g, '<hr>');
            
            return html;
        }

        // 显示报告页面
        function showReport() {
            currentPage = 8; // page-report
            showPage(currentPage);
        }

        // 保存为图片
        function saveAsImage() {
            const reportContent = document.getElementById('report-content');
            
            // 配置html2canvas选项
            const options = {
                scale: 2, // 提高分辨率
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff',
                width: reportContent.scrollWidth,
                height: reportContent.scrollHeight
            };
            
            html2canvas(reportContent, options).then(canvas => {
                // 创建下载链接
                const link = document.createElement('a');
                link.download = `商业项目定位分析报告_${new Date().toISOString().slice(0, 10)}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }).catch(error => {
                console.error('保存图片失败:', error);
                alert('保存图片失败，请稍后重试');
            });
        }

        // 复制文字
        function copyText() {
            if (window.currentReportData && window.currentReportData.markdown) {
                navigator.clipboard.writeText(window.currentReportData.markdown).then(() => {
                    alert('报告文字已复制到剪贴板');
                }).catch(error => {
                    console.error('复制失败:', error);
                    
                    // 备用复制方法
                    const textArea = document.createElement('textarea');
                    textArea.value = window.currentReportData.markdown;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        alert('报告文字已复制到剪贴板');
                    } catch (err) {
                        alert('复制失败，请手动选择文字复制');
                    }
                    document.body.removeChild(textArea);
                });
            } else {
                alert('没有可复制的报告内容');
            }
        }

        // 下载MD文件
        function downloadMD() {
            if (window.currentReportData && window.currentReportData.markdown) {
                const blob = new Blob([window.currentReportData.markdown], { type: 'text/markdown;charset=utf-8' });
                const link = document.createElement('a');
                link.download = `商业项目定位分析报告_${new Date().toISOString().slice(0, 10)}.md`;
                link.href = URL.createObjectURL(blob);
                link.click();
                URL.revokeObjectURL(link.href);
            } else {
                alert('没有可下载的报告内容');
            }
        }

        // 重新评估
        function resetAssessment() {
            if (confirm('确定要重新开始评估吗？当前数据将会清除。')) {
                // 重置所有数据
                currentPage = 0;
                scores = {
                    traffic: [1, 1, 1, 1, 1, 1],
                    operation: [1, 1, 1, 1, 1, 1],
                    service: [1, 1, 1, 1, 1, 1],
                    preference: [1]
                };
                
                // 清空表单
                document.getElementById('basic-form').reset();
                document.getElementById('project-description').value = '';
                document.getElementById('char-count').textContent = '0/100 字';
                document.getElementById('char-count').style.color = '#dc3545';
                document.getElementById('project-description').style.borderColor = '#e0e0e0';
                document.getElementById('passion-text').value = '';
                document.getElementById('report-email').value = '';
                
                // 重置所有滑块
                ['traffic', 'operation', 'service'].forEach(dimension => {
                    for (let i = 1; i <= 6; i++) {
                        const slider = document.getElementById(`${dimension}-${i}`);
                        if (slider) {
                            slider.value = 1;
                            document.getElementById(`${dimension}-${i}-value`).textContent = '1分';
                        }
                    }
                    document.getElementById(`${dimension}-total`).textContent = '6';
                });
                
                const preferenceSlider = document.getElementById('preference-1');
                if (preferenceSlider) {
                    preferenceSlider.value = 1;
                    document.getElementById('preference-1-value').textContent = '1分';
                    document.getElementById('preference-total').textContent = '1';
                }
                
                // 重置选择框
                document.querySelectorAll('input[name="target_audience"]:checked').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // 隐藏其他行业输入
                document.getElementById('other-industry-group').style.display = 'none';
                
                // 隐藏热情理由输入
                document.getElementById('passion-reason').style.display = 'none';
                
                // 清除报告数据
                window.currentReportData = null;
                
                // 重置动画状态
                document.querySelector('.status-text').classList.remove('status-completed');
                document.querySelector('.breathing-circle').classList.remove('breathing-completed');
                document.querySelector('.progress-dots').classList.remove('progress-dots-completed');
                document.getElementById('view-report-btn').style.display = 'none';
                
                // 返回首页
                showPage(0);
            }
        }

        // 调试工具
        window.debugTools = {
            // 启用API
            enableAPI: function(endpoint) {
                window.AI_API_ENABLED = true;
                window.AI_API_ENDPOINT = endpoint;
                console.log('API已启用:', endpoint);
            },
            
            // 测试API连接
            testAPI: async function() {
                try {
                    const response = await fetch('/api/generate-report', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            test: true
                        })
                    });
                    
                    const result = await response.json();
                    console.log('API测试结果:', result);
                    alert(`API连接状态: ${result.status === 'ok' ? '正常' : '异常'}`);
                    return result;
                } catch (error) {
                    console.error('API测试失败:', error);
                    alert('API连接失败');
                    return null;
                }
            },
            
            // 快速填充测试数据
            fillTestData: function() {
                document.querySelector('input[name="name"]').value = '测试用户';
                document.querySelector('input[name="contact"]').value = '13800138000';
                document.querySelector('input[name="email"]').value = 'test@example.com';
                document.querySelector('select[name="industry"]').value = 'AI从业者';
                document.querySelector('select[name="stage"]').value = '想法构思阶段';
                document.querySelector('select[name="time_investment"]').value = '兼职';
                document.querySelector('select[name="budget"]').value = '1万以下';
                document.querySelector('input[name="target_audience"][value="都市白领"]').checked = true;
                document.getElementById('project-description').value = '这是一个基于AI技术的创新项目，主要面向都市白领群体，提供智能化的商业解决方案。项目采用SaaS模式，通过月度订阅获得收入。目前处于产品原型开发阶段，已有初步的用户反馈。核心团队3人，具备技术和市场推广能力。主要挑战是如何快速获取种子用户并验证产品市场匹配度。';
                updateCharCount(document.getElementById('project-description'));
                alert('测试数据已填充');
            }
        };

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化第一页
            showPage(0);
        });
    </script>
</body>
</html>